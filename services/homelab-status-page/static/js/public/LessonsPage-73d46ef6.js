import{g as m,E as c,D as u}from"./index.js";import{P as d}from"./prism-glsl-1ad3150d.js";import{A as v,P as p}from"./Anchors-60a8aa44.js";import"./_commonjsHelpers-725317a4.js";class g{constructor(){this.$element=document.querySelector(".js-lessons-list"),this.$lessons=[...this.$element.querySelectorAll(".js-lesson")],this.$currentLesson=this.$lessons.find(e=>e.classList.contains("is-active")),this.user=typeof document.documentElement.dataset.user<"u",this.setToggle(),this.setScroll(),this.setChapters(),this.user&&(this.setStatuses(),this.setDoTriggers())}setToggle(){this.toggle={},this.toggle.visible=!1,this.toggle.$button=this.$element.querySelector(".js-toggle-button"),this.toggle.show=()=>{this.toggle.visible||(this.toggle.visible=!0,this.$element.classList.add("is-visible"))},this.toggle.hide=()=>{this.toggle.visible&&(this.toggle.visible=!1,this.$element.classList.remove("is-visible"))},this.toggle.$button.addEventListener("click",e=>{e.preventDefault(),this.toggle.visible?this.toggle.hide():this.toggle.show()}),this.toggle.keyDown=e=>{e.code==="Escape"&&this.toggle.visible&&this.toggle.hide()},this.toggle.click=e=>{this.toggle.visible&&e.target!==this.$element&&!this.$element.contains(e.target)&&this.toggle.hide()},document.addEventListener("keydown",this.toggle.keyDown),document.addEventListener("click",this.toggle.click)}setScroll(){this.scroll={},this.scroll.atBottom=!1,this.scroll.$mover=this.$element.querySelector(".js-scroll-mover"),this.scroll.$mover.scrollTop=Math.max(0,this.$currentLesson.offsetTop-this.scroll.$mover.offsetHeight*.333),this.scroll.$mover.addEventListener("scroll",()=>{this.scroll.$mover.scrollTop+this.scroll.$mover.offsetHeight>=this.scroll.$mover.scrollHeight?this.scroll.atBottom||(this.$element.classList.add("is-down"),this.scroll.atBottom=!0):this.scroll.atBottom&&(this.$element.classList.remove("is-down"),this.scroll.atBottom=!1)})}setStatuses(){this.statuses={},this.statuses.$elements=[...this.$element.querySelectorAll(".js-status")];for(const e of this.$lessons){const t=e.querySelector(".js-status"),s=t.dataset.urlDo,i=t.dataset.urlUndo;t.addEventListener("click",n=>{n.preventDefault();const r=e.classList.contains("is-done")?"undo":"do";let o=null;r==="do"?(e.classList.add("is-done"),o=s,e.classList.contains("is-current")&&e.classList.remove("is-active")):(e.classList.remove("is-done"),o=i,e.classList.contains("is-current")&&e.classList.remove("is-active")),this.chapters.update(),window.fetch(o)})}}setChapters(){this.chapters={},this.chapters.$elements=[...this.$element.querySelectorAll(".js-chapter")],this.chapters.items=[];for(const e of this.chapters.$elements){const t={};t.$head=e.querySelector(".js-chapter-head"),t.$circle=e.querySelector(".js-chapter-circle"),t.$percentage=e.querySelector(".js-chapter-percentage"),t.$cap=e.querySelector(".js-chapter-cap"),t.$lessons=[...e.querySelectorAll(".js-lesson")],t.circleLength=parseFloat(t.$circle.dataset.circleLength),this.chapters.items.push(t)}this.chapters.update=()=>{for(const e of this.chapters.items){const t=e.$lessons.length;let s=0;for(const n of e.$lessons)n.classList.contains("is-done")&&s++;const i=s/t;e.$circle.style.strokeDashoffset=(1-i)*e.circleLength,e.$percentage.textContent=Math.ceil(i*100),i===1?e.$head.classList.add("is-done"):e.$head.classList.remove("is-done")}},this.chapters.update()}setDoTriggers(){this.doTriggers={},this.doTriggers.$elements=[...document.querySelectorAll(".js-do-trigger")];for(const e of this.doTriggers.$elements)e.addEventListener("click",t=>{t.preventDefault();const s=t.metaKey?"_blank":"_self",i=e.dataset.urlDo,n=e.getAttribute("href"),r=e.href;n==="#"?window.fetch(i).then(()=>{e.classList.add("is-done")}):window.fetch(i).then(()=>{e.classList.add("is-done"),m.delayedCall(.7,()=>{s==="_self"?app.asyncNavigation.load(r):window.open(r,s)})})},{once:!0})}destroy(){document.removeEventListener("keydown",this.toggle.keyDown),document.removeEventListener("keydown",this.toggle.click)}}class y extends c{constructor(){super(),this.$element=document.querySelector(".js-tabs"),this.$mover=this.$element.querySelector(".js-tabs-mover"),this.opened=!1,this.setTabs(),this.setKeyboard(),this.setScrollUp()}setTabs(){this.tabs={},this.tabs.$buttons=[...this.$mover.querySelectorAll(".js-tabs-button")],this.tabs.$targets=[...this.$mover.querySelectorAll(".js-tabs-target")],this.tabs.target=null;for(const e of this.tabs.$buttons){const t=e.dataset.target;e.addEventListener("click",s=>{s.preventDefault(),this.opened?t!==this.tabs.target?this.open(t):this.close():this.open(t)})}}open(e){this.opened=!0,this.tabs.target=e,this.$mover.classList.add("is-visible");for(const t of this.tabs.$targets)t.classList.contains(`is-${e}`)?t.classList.add("is-active"):t.classList.remove("is-active");for(const t of this.tabs.$buttons)t.classList.contains(`is-${e}`)?t.classList.add("is-active"):t.classList.remove("is-active");this.trigger("open",[e])}close(){if(this.opened){this.opened=!1,this.$mover.classList.remove("is-visible");for(const e of this.tabs.$targets)e.classList.remove("is-active");for(const e of this.tabs.$buttons)e.classList.remove("is-active");this.trigger("close")}}setKeyboard(){this.keyboard={},this.keyboard.keyDown=e=>{e.code==="Escape"&&this.opened&&this.close()},document.addEventListener("keydown",this.keyboard.keyDown)}setScrollUp(){this.scrollUp={},this.scrollUp.button=this.$element.querySelector(".js-tabs-scroll-up"),this.scrollUp.scroll=()=>{document.documentElement.scrollTop>window.innerHeight*.5?this.scrollUp.button.classList.add("is-active"):this.scrollUp.button.classList.remove("is-active")},this.scrollUp.button.addEventListener("click",e=>{e.preventDefault(),window.scrollTo(0,0)}),window.addEventListener("scroll",this.scrollUp.scroll)}destroy(){document.removeEventListener("keydown",this.keyboard.keyDown),window.removeEventListener("scroll",this.scrollUp.scroll)}}d.manual=!0;class f{constructor(){this.sizes=app.sizes,this.$element=document.querySelector(".js-lesson-content"),this.setCodes(),this.setVideos(),this.setLazyLoad()}setCodes(){d.highlightAll();const e=this.$element.querySelectorAll("pre");for(const t of e){const s=t.innerHTML;t.addEventListener("input",i=>{t.innerHTML=s})}}setVideos(){const e=this.$element.querySelectorAll(".js-video");for(const t of e){const s=t.querySelector(".js-element");s.addEventListener("play",()=>{t.classList.add("is-playing")}),s.addEventListener("pause",()=>{t.classList.remove("is-playing")})}}setLazyLoad(){this.lazyLoad={},this.lazyLoad.items=[];const e=[...this.$element.querySelectorAll("img")];for(const t of e){const s={};s.$element=t,s.top=1/0,s.src=s.$element.dataset.src,s.loading=!1,s.loaded=!1,this.lazyLoad.items.push(s)}this.lazyLoad.update=()=>{for(const t of this.lazyLoad.items){const s=t.$element.getBoundingClientRect();t.top=s.top+window.scrollY,t.height=s.height}this.lazyLoad.test()},this.lazyLoad.test=()=>{for(const t of this.lazyLoad.items)!t.loading&&!t.loaded&&t.top<window.scrollY+this.sizes.height&&t.top+t.height>window.scrollY&&(t.loading=!0,t.$element.addEventListener("load",()=>{t.loaded=!0,t.$element.classList.add("is-loaded")},{once:!0}),t.$element.src=t.src)},window.addEventListener("resize",this.lazyLoad.update),window.addEventListener("scroll",this.lazyLoad.test)}destroy(){window.removeEventListener("resize",this.lazyLoad.update),window.removeEventListener("scroll",this.lazyLoad.test)}}class $ extends c{constructor(e){super(),this.$element=e.$element,this.sizes=app.sizes,this.enabled=!0,this.setExtent(),this.setMove(),this.setDisable(),this.setResize()}activate(){this.$element.classList.add("has-player"),this.extent.updateBounding()}deactivate(){this.$element.classList.remove("has-player")}setExtent(){this.extent={},this.extent.$handle=this.$element.querySelector(".js-handle-resize"),this.extent.dragX=0,this.extent.dragY=0,this.extent.startX=0,this.extent.startY=0,this.extent.updateBounding=()=>{const e=this.$element.getBoundingClientRect();this.extent.controlsHeight=28,this.extent.width=e.width,this.extent.height=e.height-this.extent.controlsHeight,this.extent.ratio=this.extent.width/(this.extent.height+this.extent.controlsHeight)},this.extent.down=(e,t)=>{const s=e,i=this.sizes.viewport.height-t;this.extent.updateBounding(),this.extent.dragX=s,this.extent.dragY=i,this.extent.startX=s,this.extent.startY=i},this.extent.move=(e,t)=>{const s=e,i=this.sizes.viewport.height-t;this.extent.dragX=s,this.extent.dragY=i;const n=this.extent.dragX-this.extent.startX,r=this.extent.dragY-this.extent.startY,o=(this.extent.dragX-this.move.x)/(this.extent.dragY+this.move.y);let h=null,l=null;o<this.extent.ratio?(l=this.extent.height+r,h=l*(1920/1080)):(h=this.extent.width+n,l=h/(1920/1080)),h>this.sizes.viewport.width-this.move.x&&(h=this.sizes.viewport.width-this.move.x,l=h/(1920/1080)),l>this.sizes.viewport.height+this.move.y-this.extent.controlsHeight&&(l=this.sizes.viewport.height+this.move.y-this.extent.controlsHeight,h=l*(1920/1080)),h<192&&(h=192,l=h/(1920/1080)),l+=this.extent.controlsHeight,this.$element.style.width=`${h}px`,this.$element.style.height=`${l}px`,this.trigger("resize")},this.extent.up=()=>{this.extent.updateBounding()},this.extent.mouseDown=e=>{e.preventDefault(),this.extent.down(e.clientX,e.clientY),document.addEventListener("mousemove",this.extent.mouseMove),document.addEventListener("mouseup",this.extent.mouseUp)},this.extent.mouseMove=e=>{e.preventDefault(),this.extent.move(e.clientX,e.clientY)},this.extent.mouseUp=()=>{this.extent.up(),document.removeEventListener("mousemove",this.extent.mouseMove),document.removeEventListener("mouseup",this.extent.mouseUp)},this.extent.$handle.addEventListener("mousedown",this.extent.mouseDown),this.extent.touchStart=e=>{e.preventDefault(),this.extent.down(e.touches[0].clientX,e.touches[0].clientY),document.addEventListener("touchmove",this.extent.touchMove),document.addEventListener("touchend",this.extent.touchEnd)},this.extent.touchMove=e=>{e.preventDefault(),this.extent.move(e.touches[0].clientX,e.touches[0].clientY)},this.extent.touchEnd=()=>{this.extent.up(),document.removeEventListener("touchmove",this.extent.touchMove),document.removeEventListener("touchend",this.extent.touchEnd)},this.extent.$handle.addEventListener("touchstart",this.extent.touchStart)}setMove(){this.move={},this.move.$handle=this.$element.querySelector(".js-handle-move"),this.move.x=0,this.move.y=0,this.move.dragX=0,this.move.dragY=0,this.move.down=(e,t)=>{this.move.dragX=e,this.move.dragY=t},this.move.move=(e,t)=>{const s=e-this.move.dragX,i=t-this.move.dragY;this.move.dragX=e,this.move.dragY=t,this.move.x+=s,this.move.y+=i,this.move.x=Math.max(Math.min(Math.round(this.move.x),this.sizes.viewport.width-this.extent.width),0),this.move.y=Math.min(Math.max(Math.round(this.move.y),-(this.sizes.viewport.height-this.extent.height-this.extent.controlsHeight)),0),this.$element.style.transform=`translate(${this.move.x}px, ${this.move.y}px)`,this.trigger("move")},this.move.up=()=>{},this.move.mouseDown=e=>{e.preventDefault(),this.move.down(e.clientX,e.clientY),document.addEventListener("mousemove",this.move.mouseMove),document.addEventListener("mouseup",this.move.mouseUp)},this.move.mouseMove=e=>{e.preventDefault(),this.move.move(e.clientX,e.clientY)},this.move.mouseUp=()=>{this.move.up(),document.removeEventListener("mousemove",this.move.mouseMove),document.removeEventListener("mouseup",this.move.mouseUp)},this.move.$handle.addEventListener("mousedown",this.move.mouseDown),this.move.touchStart=e=>{e.preventDefault(),this.move.down(e.touches[0].clientX,e.touches[0].clientY),document.addEventListener("touchmove",this.move.touchMove),document.addEventListener("touchend",this.move.touchEnd)},this.move.touchMove=e=>{e.preventDefault(),this.move.move(e.touches[0].clientX,e.touches[0].clientY)},this.move.touchEnd=()=>{this.move.up(),document.removeEventListener("touchmove",this.move.touchMove),document.removeEventListener("touchend",this.move.touchEnd)},this.move.$handle.addEventListener("touchstart",this.move.touchStart)}setDisable(){this.disable={},this.disable.$handle=this.$element.querySelector(".js-handle-disable"),this.disable.$handle.addEventListener("click",()=>{this.enabled=!1,this.deactivate(),this.trigger("disabled")})}setResize(){this.sizes.on("resize.playerFloating",()=>{if(this.move.x+this.extent.width>this.sizes.viewport.width)if(this.extent.width<this.sizes.viewport.width)this.move.x=this.sizes.viewport.width-this.extent.width,this.$element.style.transform=`translate(${this.move.x}px, ${this.move.y}px)`;else{this.move.x=0,this.$element.style.transform=`translate(${this.move.x}px, ${this.move.y}px)`;let e=this.sizes.viewport.width,t=e/(1920/1080);t+=this.extent.controlsHeight,this.$element.style.width=`${e}px`,this.$element.style.height=`${t}px`,this.extent.updateBounding()}if(Math.abs(this.move.y)+this.extent.height>this.sizes.viewport.height-this.extent.controlsHeight)if(this.extent.height<this.sizes.viewport.height-this.extent.controlsHeight)this.move.y=-(this.sizes.viewport.height-this.extent.height-this.extent.controlsHeight),this.$element.style.transform=`translate(${this.move.x}px, ${this.move.y}px)`;else{this.move.y=0,this.$element.style.transform=`translate(${this.move.x}px, ${this.move.y}px)`;let e=this.sizes.viewport.height-this.extent.controlsHeight,t=e*(1920/1080);e+=this.extent.controlsHeight,this.$element.style.width=`${t}px`,this.$element.style.height=`${e}px`,this.extent.updateBounding()}})}destroy(){this.extent.$handle.removeEventListener("mousedown",this.extent.mouseDown),this.extent.$handle.removeEventListener("touchstart",this.extent.touchStart),this.move.$handle.removeEventListener("mousedown",this.move.mouseDown),this.move.$handle.removeEventListener("touchstart",this.move.touchStart),document.removeEventListener("mousemove",this.extent.mouseMove),document.removeEventListener("mouseup",this.extent.mouseUp),document.removeEventListener("touchmove",this.extent.touchMove),document.removeEventListener("touchend",this.extent.touchEnd),document.removeEventListener("mousemove",this.move.mouseMove),document.removeEventListener("mouseup",this.move.mouseUp),document.removeEventListener("touchmove",this.move.touchMove),document.removeEventListener("touchend",this.move.touchEnd),this.sizes.off("resize.playerFloating")}}class L extends c{constructor(e){super(),this.$element=e.$element,this.sizes=app.sizes,this.width=1920,this.height=1080,this.setResize()}activate(){this.$element.classList.add("has-player")}deactivate(){this.$element.classList.remove("has-player")}setResize(){this.sizes.on("resize.playerTop",()=>{this.resize()}),this.resize()}resize(){const e=this.$element.getBoundingClientRect();this.width=e.width,this.height=e.height,this.bottom=e.bottom+window.scrollY,this.trigger("resize")}destroy(){this.sizes.off("resize.playerTop")}}class x{constructor(){this.$element=document.querySelector(".js-table-of-content"),this.$links=[...this.$element.querySelectorAll(".js-link")],this.$activeLink=null,this.source=""}setSlug(e,t){const s=[];let i=null;for(const n of this.$links)if(n.dataset.slug===e){i=n;break}else s.push(n);if(i){for(const o of s)o.classList.add("is-done");const n=this.$links.filter(function(o){return s.indexOf(o)<0});for(const o of n)o.classList.remove("is-done");const r=this.$links.filter(function(o){return o!==i});for(const o of r)o.classList.remove("is-active");i.classList.add("is-active"),t!==this.source&&(this.$element.classList.remove(`is-source-${this.source}`),this.$element.classList.add(`is-source-${t}`),this.source=t),this.$activeLink=i}}}class S extends u{onEnterCompleted(){super.onEnterCompleted(),this.sizes=app.sizes,this.popins=app.popins,this.lessonsList=new g,this.lessonsContent=new f,this.anchors=new v,this.tabs=new y,this.setPlayer(),this.setVideoJumps(),this.setTableOfContent(),this.lessonsContent.lazyLoad.update(),this.popins.open("popin-start")}setPlayer(){const e=document.querySelector(".js-player");e&&(this.player={},this.player.mode="top",this.player.instance=new p({$element:e}),this.player.top=new L({$element:document.querySelector(".js-player-top")}),this.player.top.activate(),this.player.top.on("resize",()=>{this.player.instance.resize()}),this.player.floating=new $({$element:document.querySelector(".js-player-floating")}),this.player.floating.on("resize",()=>{this.player.instance.resize()}),this.player.floating.on("move",()=>{this.player.instance.resize()}),this.player.floating.on("disabled",()=>{this.player.top.$element.appendChild(this.player.instance.$container),this.player.top.activate(),this.player.instance.resize()}),this.player.instance.resize(),this.player.scroll=()=>{if(!this.player.floating.enabled)return;const t=window.scrollY>this.player.top.bottom?"floating":"top";if(t!==this.player.mode){const s=this.player.mode;this.player.mode=t,this.player[this.player.mode].$element.appendChild(this.player.instance.$container),this.player[this.player.mode].activate(),this.player[s].deactivate(),this.player.instance.resize(),t==="top"&&this.tableOfContent&&this.tableOfContent.setSlug(this.player.instance.seekbar.currentSection.slug,"player")}},window.addEventListener("scroll",this.player.scroll))}setVideoJumps(){const e=document.querySelectorAll(".js-video-jump");for(const t of e){const s=parseInt(t.dataset.time);t.addEventListener("click",i=>{i.preventDefault(),this.player.instance.$video.currentTime=s,this.player.instance.$video.play(),this.player.instance.time.update(),this.player.instance.seekbar.canvas.update(),window.scrollTo(0,0),window.requestAnimationFrame(()=>{window.scrollTo(0,0)})})}}setTableOfContent(){this.tableOfContent=new x,this.anchors.on("sectionChange",t=>{t&&(!this.player||this.player.mode==="floating")&&this.tableOfContent.setSlug(t.slug,"anchors")}),this.player&&this.player.instance.on("seekbarSectionChanged",t=>{this.player.mode==="top"&&this.tableOfContent.setSlug(t.slug,"player")});const e=this.tableOfContent.$element.parentElement;this.tabs.on("open",t=>{if(t==="table-of-content"){const s=this.tableOfContent.$activeLink;s&&e.scrollTo(0,s.offsetTop-200)}})}onLeave(){super.onLeave(),this.sizes.off("resize.home"),this.lessonsList.destroy(),this.tabs.destroy(),this.lessonsContent.destroy(),this.player&&(this.player.top.destroy(),this.player.floating.destroy(),this.player.instance.destroy(),window.removeEventListener("scroll",this.player.scroll)),this.anchors.destroy()}}export{S as default};
//# sourceMappingURL=LessonsPage-73d46ef6.js.map
